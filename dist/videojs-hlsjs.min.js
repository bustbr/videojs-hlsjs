/*! videojs-hlsjs - v2.0.0 - 2018-02-23*/

!function(a,b){"object"==typeof exports&&"undefined"!=typeof module?b(require(["video.js","hls"])):"function"==typeof define&&define.amd?define(["video.js","hls"],b):b(a.videojs,a.Hls)}(this,function(a,b){"use strict";var c=a.getTech("Tech"),d=a.getTech("Html5"),e=a.extend(d,{initHls_:function(){this.options_.hls.autoStartLoad=!1,this.hls_=new b(this.options_.hls),this.bindExternalCallbacks_(),this.hls_.on(b.Events.MEDIA_ATTACHED,a.bind(this,this.onMediaAttached_)),this.hls_.on(b.Events.MANIFEST_PARSED,a.bind(this,this.onManifestParsed_)),this.hls_.on(b.Events.MANIFEST_LOADED,a.bind(this,this.initAudioTracks_)),this.hls_.on(b.Events.MANIFEST_LOADED,a.bind(this,this.initTextTracks_)),this.hls_.on(b.Events.LEVEL_UPDATE,a.bind(this,this.updateTimeRange_)),this.hls_.on(b.Events.ERROR,a.bind(this,this.onError_)),this.el_.addEventListener("error",a.bind(this,this.onMediaError_)),this.currentLevel_=void 0,this.setLevelOnLoad_=void 0,this.lastLevel_=void 0,this.timeRange_=void 0,this.starttime_=-1,this.levels_=[],this.hls_.attachMedia(this.el_)},bindExternalCallbacks_:function(){var c;for(c in b.Events)if(Object.prototype.hasOwnProperty.call(b.Events,c)){var d=b.Events[c],e=function(a,b,c){var d=b["on"+function(a){return a.charAt(0).toUpperCase()+a.slice(1)}(a)];if(d&&"function"==typeof d)return function(a,b){return function(c,d){a(b,d)}}(d,c)}(d,this.options_,this.hls_);e&&this.hls_.on(d,a.bind(this,e))}},onMediaAttached_:function(){this.triggerReady()},updateTimeRange_:function(){var a;if(this.hls_&&this.hls_.currentLevel>=0){var b=this.hls_.levels[this.hls_.currentLevel].details;if(b){var c=b.fragments,e=b.live,f=e?2:0,g=c[f>c.length?0:f],h=this.hls_.config.liveSyncDurationCount,i=e?c.length-h:c.length-1,j=c[i<0?0:i];a={start:g.start,end:j.start+j.duration}}}if(a||this.timeRange_)a||(a=this.timeRange_);else{var k=d.prototype.duration.apply(this);k&&!isNaN(k)&&(a={start:0,end:k})}this.timeRange_=a},play:function(){"none"!==this.preload()||this.hasStarted_||(this.setLevelOnLoad_&&this.setLevel(this.setLevelOnLoad_),this.hls_.startLoad(this.starttime())),d.prototype.play.apply(this)},duration:function(){return this.updateTimeRange_(),this.timeRange_?this.timeRange_.end-this.timeRange_.start:void 0},currentTime:function(){return this.updateTimeRange_(),this.hls_.currentLevel!==this.lastLevel_&&this.trigger("levelswitched"),this.lastLevel_=this.hls_.currentLevel,d.prototype.currentTime.apply(this)},seekable:function(){return this.timeRange_?{start:function(){return this.timeRange_.start}.bind(this),end:function(){return this.timeRange_.end}.bind(this),length:1}:{length:0}},onManifestParsed_:function(){var a,b,c=!this.options_.disableAutoLevel;this.parseLevels_(),this.levels_.length>0?(this.options_.setLevelByHeight?(a=this.getLevelByHeight_(this.options_.setLevelByHeight),b=!1):this.options_.startLevelByHeight&&(a=this.getLevelByHeight_(this.options_.startLevelByHeight),b=c),c||a&&-1!==a.index||(a=this.levels_[this.levels_.length-1],b=!1)):c||(a={index:this.hls_.levels.length-1},b=!1),a&&(this.hls_.startLevel=a.index),"none"!==this.preload()?(!b&&a&&this.setLevel(a),this.hls_.startLoad(this.starttime())):!b&&a&&(this.setLevelOnLoad_=a,this.currentLevel_=a),this.autoplay()&&this.paused()&&this.play(),this.trigger("levelsloaded")},initAudioTracks_:function(){var b,c=[],d=this.audioTracks(),e=this.hls_.audioTracks,f=[],g=[],h=function(a){var b=this.hls_;return a.groups.reduce(function(a,c){return a||c.id===b.audioTrack},!1)},i=function(a){if(this.enabled){var b=a.currentLevel(),c=this.hlsGroups_.reduce(function(a,c){return c.groupId===b.audio&&(a=c.id),a},this.hlsTrackId_);c!==this.hlsTrackId_&&(a.hls_.audioTrack=c)}},j=0;for(e.forEach(function(a){var b=void 0!==a.groupId?a.name:"no-groups",c={id:a.id,groupId:a.groupId};if(void 0===f[b]){f[b]=j,g[j]=[];var d=a;d.groups=[],d.groups.push(c),g[j]=d,j++}else g[f[a.name]].groups.push(c)}),b=0;b<d.length;b++){var k=d[b];void 0!==k.hlsTrackId_&&c.push(k)}for(b=0;b<c.length;b++)d.removeTrack_(c[b]);for(b=0;b<g.length;b++){var l=g[b],m=new a.AudioTrack({type:l.type,language:l.lang,label:l.name,enabled:h.bind(this,l)()});m.hlsTrackId_=l.id,m.hlsGroups_=l.groups,m.addEventListener("enabledchange",i.bind(m,this)),d.addTrack(m)}},initTextTracks_:function(){var b,c=[],d=this.textTracks(),e=this.hls_.subtitleTracks,f=function(){this.tech_.el_.textTracks[this.hlsTrack_.vjsId].mode=this.mode};for(b=0;b<d.length;b++){var g=d[b];void 0!==g.hlsTrack_&&c.push(g)}for(b=0;b<c.length;b++)d.removeTrack_(c[b]);var h=!1;for(b=0;b<e.length;b++){var i=e[b],j=new a.TextTrack({srclang:i.lang,label:i.name,mode:void 0!==i.default&&i.default&&!h?"showing":"hidden",tech:this});void 0!==i.default&&i.default&&(h=!0),j.hlsTrack_=i,j.hlsTrack_.vjsId=b+1,j.addEventListener("modechange",f),d.addTrack_(j)}h&&this.trigger("texttrackchange")},getLevelByHeight_:function(a){var b,c;for(b=0;b<this.levels_.length;b++){var d=this.levels_[b],e=Math.abs(a-d.height),f=c,g=void 0!==f?Math.abs(a-f.height):void 0;(void 0===g||g>e)&&(c=this.levels_[b])}return c},parseLevels_:function(){if(this.levels_=[],this.currentLevel_=void 0,this.hls_.levels){var a;for(this.options_.disableAutoLevel||(this.levels_.push({label:"auto",index:-1,height:-1}),this.currentLevel_=this.levels_[0]),a=0;a<this.hls_.levels.length;a++){var b=this.hls_.levels[a],c=null;b.height&&(c={label:b.height+"p",index:a,bitrate:b.bitrate,height:b.height}),void 0!==b.attrs.AUDIO&&(c=c||{},c.index=a,c.audio=b.attrs.AUDIO),c&&this.levels_.push(c)}this.levels_.length<=1&&(this.levels_=[],this.currentLevel_=void 0)}},setSrc:function(a){this.hls_&&this.hls_.destroy(),this.currentLevel_&&(this.options_.setLevelByHeight=this.currentLevel_.height),this.initHls_(),this.hls_.loadSource(a)},onMediaError_:function(a){var c=a.currentTarget.error;if(c&&c.code===c.MEDIA_ERR_DECODE){var d={type:b.ErrorTypes.MEDIA_ERROR,fatal:!0,details:"mediaErrorDecode"};this.onError_(a,d)}},onError_:function(c,d){if([b.ErrorDetails.MANIFEST_LOAD_ERROR,b.ErrorDetails.MANIFEST_LOAD_TIMEOUT,b.ErrorDetails.MANIFEST_PARSING_ERROR].indexOf(d.details)>=0)a.log.error('HLSJS: Fatal error: "'+d.details+'", aborting playback.'),this.hls_.destroy(),this.error=function(){return{code:3}},this.trigger("error");else if(d.fatal)switch(d.type){case b.ErrorTypes.NETWORK_ERROR:a.log.warn('HLSJS: Network error: "'+d.details+'", trying to recover...'),this.hls_.startLoad(),this.trigger("waiting");break;case b.ErrorTypes.MEDIA_ERROR:var e=function(){this.hls_.startLoad(),this.hls_.off(b.Events.MEDIA_ATTACHED,e)}.bind(this);a.log.warn('HLSJS: Media error: "'+d.details+'", trying to recover...'),this.hls_.swapAudioCodec(),this.hls_.recoverMediaError(),this.hls_.on(b.Events.MEDIA_ATTACHED,e),this.trigger("waiting");break;default:a.log.error('HLSJS: Fatal error: "'+d.details+'", aborting playback.'),this.hls_.destroy(),this.error=function(){return{code:3}},this.trigger("error")}},currentLevel:function(){var a=!this.options_.disableAutoLevel;return this.currentLevel_&&-1===this.currentLevel_.index?this.levels_[a?this.hls_.currentLevel+1:this.hls_.currentLevel]:this.currentLevel_},isAutoLevel:function(){return this.currentLevel_&&-1===this.currentLevel_.index},setLevel:function(a){this.currentLevel_=a,this.setLevelOnLoad_=void 0,this.hls_.currentLevel=a.index,this.hls_.loadLevel=a.index},getLevels:function(){return this.levels_},supportsStarttime:function(){return!0},starttime:function(a){if(!a)return this.starttime_;this.starttime_=a},dispose:function(){return this.hls_&&this.hls_.destroy(),d.prototype.dispose.apply(this)}});e.isSupported=function(){return b.isSupported()},e.canPlaySource=function(c){return!(a.options.hlsjs.favorNativeHLS&&d.canPlaySource(c))&&c.type&&/^application\/(?:x-|vnd\.apple\.)mpegurl/i.test(c.type)&&b.isSupported()},a.options.hlsjs={favorNativeHLS:!0,hls:{}},c.registerTech("hlsjs",e)});